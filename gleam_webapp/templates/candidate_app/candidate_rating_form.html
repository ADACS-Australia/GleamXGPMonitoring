{% extends 'candidate_app/header.html' %}

{% block content %}

<title>Candidate Rating ID:{{ candidate.id }} </title>
<h2>Candidate Rating ID:{{ candidate.id }}</h2>
{% if candidate %}
<div class="row">

  <div class="col">
    <div class="card">
      <center>
      {% if candidate.png_path %}
          <img src="{{candidate.png_path.url}}" alt="Diagnostic Plot for {{candidate.id}}" onClick="window.open(this.src)">
      {% endif %}
      {% if candidate.gif_path %}
        <img src="{{candidate.gif_path.url}}"
            width="125"
            alt="Diagnostic GIF for {{candidate.id}}"
            onClick="window.open(this.src)">
      {% endif %}
      </center>
    </div>
  </div>

  <div class="col-3">
    <div class="card">
        <div class="card-content">
            <h3>Candidate:</h3>
            <table>
              <!-- <tr><td>Location (deg)</td>                      <td>{{ candidate.ra_dec }}, {{ candidate.dec_dec}}</td></tr> -->
              <tr><td>Detection statistic</td> <td>{{ candidate.can_det_stat|floatformat:2 }}</td></tr>
              <tr><td>Peak Flux (Jy)</td>      <td>{{ candidate.can_peak_flux|floatformat:2 }}</td></tr>
              <tr><td>Primary Beam</td>        <td>{{ candidate.can_beam|floatformat:2 }}</td></tr>
              <tr><td>Separation from obs center (deg)</td> <td>{{ candidate.cent_sep_deg|floatformat:2 }}</td></tr>
              <tr><td>Location</td>            <td>{{ candidate.ra_hms }}, {{ candidate.dec_dms }}</td></tr>
              <tr><td>Radius (deg)</td>        <td>{{ candidate.rad_deg|floatformat:3}}</td></tr>
            </table>
            <h3>Nearest Known Source:</h3>
            <table>
              <tr><td>Source name</td>      <td>{{ candidate.nks_name }}</td></tr>
              <tr><td>Location</td>         <td>{{ candidate.nks_ra_hms }}, {{ candidate.nks_dec_dms }}</td></tr>
              {% if candidate.can_nks_is_close %}
                <tr>
              {% else %}
                <tr class="NegativeTransaction">
              {% endif %}
              <td>Separation (arcmin)</td>  <td>{{ sep_arcmin|floatformat:2 }}</td></tr>
              <tr><td>Flux (Jy)</td>        <td>{{ candidate.nks_flux|floatformat:2 }}</td></tr>
              <tr><td>Flux ratio</td>       <td>{{ candidate.can_nks_flux_rat|floatformat:2 }}</td></tr>
            </table>
            <h3>SIMBAD {{ arcmin_search }} arcmin search:</h3>
            <table class="fl-table">
              <!-- <thead> -->
              <tr>
                <th>Name</th>
                <th>RA</th>
                <th>Dec</th>
              </tr>
              <!-- </thead> -->
              <!-- Iterate over object_list -->
              {% for result in result_table %}
              <!-- Display Objects -->
              <tr>
                <td><a href="https://simbad.cds.unistra.fr/simbad/sim-id?Ident={{ result.search_term }}&NbIdent=1&submit=submit+id" style="text-decoration:None">{{ result.name }}</a></td>
                <td>{{ result.ra }}</td>
                <td>{{ result.dec }}</td>
              </tr>
              <!-- If object_list is empty  -->
              {% empty %}
              <tr><td>No Sources found</td></tr>
              {% endfor %}
            </table>
            <form action="{% url 'candidate_update_simbad' id=candidate.id %}" method="post">
              {% csrf_token %}
              <label for="simbad">Research with arcmins:</label>
              <input id="simbad" type="text"  name="simbad">
              <input class="btn btn-primary" type="submit" value="Submit">
            </form>
        </div>
      </div>
  </div>

  <div class="col-2">
    <div class="card">
      <div class="card-content">
        <h3>Observation:</h3>
        <table>
          <tr><td>Observation ID</td>  <td><a href="http://ws.mwatelescope.org/observation/obs/?obs_id={{ candidate.obs_id.observation_id }}" target="_blank">{{ candidate.obs_id.observation_id }}</a></td></tr>
          <tr><td>Time (UTC)</td>      <td>{{ time }}</td></tr>
          <tr><td>Frequency (MHz)</td> <td>{{ candidate.obs_id.cent_freq }}</td></tr>
        </table>
        <h3>Rate Current Candidate:</h3>
        <form action="{% url 'candidate_update_rating' id=candidate.id %}" method="post">
          {% csrf_token %}
          <div class="field">
          <!-- <label for="rfi">Is RFI?</label>
          <input type="checkbox"  id='rfi' value='True' name="rfi"><br> -->
          <h4>Choose candidate type:</h4>

          {% for value, text in cand_type_choices %}
            {% if value == "T" %}
              <input checked="checked"
            {% else %}
              <input
            {% endif %}
              type="radio" name="cand_type" id="{{ value }}" value="{{ value }}">
            <label for="{{ value }}">{{ text }}</label><br>
          {% endfor %}

          </div>
          <div class="field">
          <h4>Rating from 1(noise) to 5(clear candidate){% if rating %}(currently {{rating.rating}}){% endif %}</h4>
          <div>
            <input type="submit" class="btn btn-primary btn-lg" name="rating" value="1">
            <input type="submit" class="btn btn-primary btn-lg" name="rating" value="2">
            <input type="submit" class="btn btn-primary btn-lg" name="rating" value="3">
            <input type="submit" class="btn btn-primary btn-lg" name="rating" value="4">
            <input type="submit" class="btn btn-primary btn-lg" name="rating" value="5">
          </div>
          </div>
          <div class="field">
          <h4>Notes</h4>
          <textarea rows="5" id="notes" name="notes" placeholder="is it a known source?">{{candidate.notes}}</textarea>
          </div>
          <input type="hidden" name="id" value="">
          <input type="hidden" name="username" value="{{user}}">
        </form>
        <button class="btn btn-info" onclick="window.history.go(-1)">Back to previous</button>
      </div>
    </div>
  </div>
</div>
{% else %}
<p>Candidate not Found!</p>
{% endif %}
{% endblock %}